{% extends 'main/base.html' %}
{% block title %}Add to Cart{% endblock %}

{% block content %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<div class="container my-5">
  <h4 class="mb-4">Home ‚Ä∫ Add to Cart</h4>
  <div class="row">
    <!-- Left: Cart items -->
    <div class="col-md-8" id="cart-container"></div>

    <!-- Right: Cart Summary -->
    <div class="col-md-4">
      <div class="bg-light p-4 rounded border">
        <h5>Cart Total</h5>
        <hr>
        <p><strong>Subtotal:</strong> ‚Çπ<span id="subtotal">0</span></p>
        <p><strong>Discount:</strong> ‚Çπ<span id="discount">250</span></p>
        <p><strong>Shipping:</strong> Free</p>
        <hr>
        <h5>Total: ‚Çπ<span id="grand-total">0</span></h5>
        <button class="btn btn-info mt-3 w-100" onclick="processCheckout()" id="payBtn">Process to checkout</button>
        <div id="success-msg" class="alert alert-success mt-3 d-none">
          ‚úÖ Payment Successful! Thank you for your purchase.
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function updateCartInLocalStorage(cart) {
    localStorage.setItem('cart', JSON.stringify(cart));
  }

  function renderCart() {
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    const container = document.getElementById('cart-container');
    const subtotalEl = document.getElementById('subtotal');
    const totalEl = document.getElementById('grand-total');
    const discount = 250;

    if (cart.length === 0) {
      container.innerHTML = '<p>Your cart is empty.</p>';
      subtotalEl.textContent = '0';
      totalEl.textContent = '0';
      return;
    }

    let total = 0;
    let html = `
      <table class="table table-bordered align-middle text-center">
        <thead class="table-light">
          <tr>
            <th>Product</th><th>Price</th><th>Quantity</th><th>Subtotal</th><th>Action</th>
          </tr>
        </thead>
        <tbody>
    `;

    cart.forEach((item, index) => {
      const subtotal = item.price * item.quantity;
      total += subtotal;
      html += `
        <tr>
          <td class="text-start">
            <img src="${item.image}" width="50" class="me-2"> ${item.name}
          </td>
          <td>‚Çπ${item.price}</td>
          <td>
            <button class="btn btn-sm btn-outline-secondary" onclick="updateQuantity(${index}, -1)">‚Äì</button>
            <span class="mx-2">${item.quantity}</span>
            <button class="btn btn-sm btn-outline-secondary" onclick="updateQuantity(${index}, 1)">+</button>
          </td>
          <td>‚Çπ${subtotal}</td>
          <td>
            <button class="btn btn-sm btn-danger" onclick="removeItem(${index})">üóëÔ∏è</button>
          </td>
        </tr>
      `;
    });

    html += `</tbody></table>`;
    container.innerHTML = html;

    // Update summary
    subtotalEl.textContent = total;
    totalEl.textContent = total - discount;
  }

 function updateQuantity(index, change) {
  const cart = JSON.parse(localStorage.getItem('cart')) || [];
  cart[index].quantity += change;
  if (cart[index].quantity <= 0) {
    cart.splice(index, 1);
  }
  updateCartInLocalStorage(cart);
  renderCart();
  updateCartCount(); // ‚úÖ Add this
}

function removeItem(index) {
  const cart = JSON.parse(localStorage.getItem('cart')) || [];
  cart.splice(index, 1);
  updateCartInLocalStorage(cart);
  renderCart();
  updateCartCount(); // ‚úÖ Add this
}
 function processCheckout() {
  const cart = JSON.parse(localStorage.getItem('cart')) || [];
  if (cart.length === 0) return;

  document.getElementById('success-msg').classList.remove('d-none');

  localStorage.removeItem('cart');
  updateCartCount(); // ‚úÖ Add this

  setTimeout(() => {
    renderCart();
  }, 1000);
}


  document.addEventListener('DOMContentLoaded', renderCart);
</script>
<script>
  document.getElementById("payBtn").addEventListener("click", function () {
    // Show success message
    alert("Payment Successful!");

    // Clear the cart
    localStorage.removeItem("cart");

    // Update the cart count icon to 0
    updateCartCount();

    // Optionally redirect to home or thank you page
    // window.location.href = "index.html";
  });
</script>

{% endblock %}


